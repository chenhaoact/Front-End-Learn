<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CanvasColock</title>
</head>
<body style="height:100%">
<canvas id="canvas" style="height:100%"></canvas>
</body>
<script type="text/javascript">
    /**
     * 1. 0-9的数组以及冒号这些字符都是以二维数组存好的，1表示显示圆圈，0表示不显示，组合就能显示特定的字符
     * */
    digit =
        [
            [
                [0, 0, 1, 1, 1, 0, 0],
                [0, 1, 1, 0, 1, 1, 0],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 1, 1, 0, 1, 1, 0],
                [0, 0, 1, 1, 1, 0, 0]
            ],//0
            [
                [0, 0, 0, 1, 1, 0, 0],
                [0, 1, 1, 1, 1, 0, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [1, 1, 1, 1, 1, 1, 1]
            ],//1
            [
                [0, 1, 1, 1, 1, 1, 0],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 1, 1, 0, 0, 0],
                [0, 1, 1, 0, 0, 0, 0],
                [1, 1, 0, 0, 0, 0, 0],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 1, 1, 1, 1, 1]
            ],//2
            [
                [1, 1, 1, 1, 1, 1, 1],
                [0, 0, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 1, 1, 1, 0, 0],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 1, 1, 1, 1, 1, 0]
            ],//3
            [
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 1, 1, 1, 0],
                [0, 0, 1, 1, 1, 1, 0],
                [0, 1, 1, 0, 1, 1, 0],
                [1, 1, 0, 0, 1, 1, 0],
                [1, 1, 1, 1, 1, 1, 1],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 1, 1, 1, 1]
            ],//4
            [
                [1, 1, 1, 1, 1, 1, 1],
                [1, 1, 0, 0, 0, 0, 0],
                [1, 1, 0, 0, 0, 0, 0],
                [1, 1, 1, 1, 1, 1, 0],
                [0, 0, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 1, 1, 1, 1, 1, 0]
            ],//5
            [
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 1, 1, 0, 0, 0],
                [0, 1, 1, 0, 0, 0, 0],
                [1, 1, 0, 0, 0, 0, 0],
                [1, 1, 0, 1, 1, 1, 0],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 1, 1, 1, 1, 1, 0]
            ],//6
            [
                [1, 1, 1, 1, 1, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 1, 1, 0, 0, 0],
                [0, 0, 1, 1, 0, 0, 0],
                [0, 0, 1, 1, 0, 0, 0],
                [0, 0, 1, 1, 0, 0, 0]
            ],//7
            [
                [0, 1, 1, 1, 1, 1, 0],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 1, 1, 1, 1, 1, 0],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 1, 1, 1, 1, 1, 0]
            ],//8
            [
                [0, 1, 1, 1, 1, 1, 0],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 1, 1, 1, 0, 1, 1],
                [0, 0, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 1, 1, 0, 0, 0, 0]
            ],//9
            [
                [0, 0, 0, 0],
                [0, 0, 0, 0],
                [0, 1, 1, 0],
                [0, 1, 1, 0],
                [0, 0, 0, 0],
                [0, 0, 0, 0],
                [0, 1, 1, 0],
                [0, 1, 1, 0],
                [0, 0, 0, 0],
                [0, 0, 0, 0]
            ]//:
        ];
</script>
<script type="text/javascript">
    /**
     * 2. 用到的一些变量统一写在这里，后面代码统一用这里的变量而不是写死。
     * 优点：
     * 改变时统一，只需要改一次；
     * 拿到窗口宽来做屏幕自适应的时候直接拿到这些值去改变就可以了
     * */
    var WINDOW_WIDTH;
    var WINDOW_HEIGHT;
    var RADIUS;
    var context = canvas.getContext("2d");
    var MARGIN_TOP;
    var MARGIN_LEFT;
    var showtime = new Date();
    var balls = [];
    const colors = ["#51F511", "#66FAD5", "#EF1C3E", "#FFFA5F", "#DE48CD", "#310CF2"];
    window.onload = function () {
        WINDOW_WIDTH = document.documentElement.clientWidth;
        WINDOW_HEIGHT = document.documentElement.clientHeight;
        MARGIN_LEFT = Math.round(WINDOW_WIDTH / 10);
        MARGIN_TOP = Math.round(WINDOW_HEIGHT / 5);
        RADIUS = Math.round(WINDOW_WIDTH * 4 / 5 / 108) - 1;
        var canvas = document.getElementById("canvas");
        showtime = new Date();
        canvas.width = WINDOW_WIDTH;
        canvas.height = WINDOW_HEIGHT;
        setInterval(function () {
            render(context);
            update();
        }, 50);

    }
    /**
     * 3.绘制时钟字符与倒计时的逻辑
     * */
    function render(cxt) {
        cxt.clearRect(0, 0, WINDOW_WIDTH, WINDOW_HEIGHT);
        /**
         * 4. 定义目前要显示的时间，时，分，秒
         * 编码时可以先取常量数字，实现静态效果后，在改为变量
         * 这里的变量是从上面外部定义showtime传过来的，showtime使用js的new Date()取到时间
         * */
        var hours = parseInt(showtime.getHours());
        var minutes = parseInt(showtime.getMinutes());
        var seconds = parseInt(showtime.getSeconds());
        /**
         * 5.绘制每个时间或:号字符的逻辑写在renderDigit()中，
         * 每次调用它来绘制响应字符
         * parseInt(hours / 10) 拿到hours数据的十位数
         * hours % 10 拿到hours数据的个位数
         * */
        renderDigit(MARGIN_LEFT, MARGIN_TOP, parseInt(hours / 10), cxt);
        renderDigit(MARGIN_LEFT + 15 * (RADIUS + 1), MARGIN_TOP, parseInt(hours % 10), cxt);
        renderDigit(MARGIN_LEFT + 30 * (RADIUS + 1), MARGIN_TOP, 10, cxt);
        renderDigit(MARGIN_LEFT + 39 * (RADIUS + 1), MARGIN_TOP, parseInt(minutes / 10), cxt);
        renderDigit(MARGIN_LEFT + 54 * (RADIUS + 1), MARGIN_TOP, parseInt(minutes % 10), cxt);
        renderDigit(MARGIN_LEFT + 69 * (RADIUS + 1), MARGIN_TOP, 10, cxt);
        renderDigit(MARGIN_LEFT + 78 * (RADIUS + 1), MARGIN_TOP, parseInt(seconds / 10), cxt);
        renderDigit(MARGIN_LEFT + 93 * (RADIUS + 1), MARGIN_TOP, parseInt(seconds % 10), cxt);
        for (var i = 0; i < balls.length; i++) {
            cxt.fillStyle = balls[i].color;
            cxt.beginPath();
            cxt.arc(balls[i].x, balls[i].y, RADIUS, 0, 2 * Math.PI, true);
            cxt.closePath();
            cxt.fill();
        }
    }
    /**
     * 6.绘制每个时间或:号字符的逻辑写
     * 参数：
     * x y 绘制字符的开始位置坐标
     * num 绘制那个个位数
     * cxt 绘制的上下文环境，要实现绘制就必须把canvas绘制的上下文环境传过去
     * */
    function renderDigit(x, y, num, cxt) {
        cxt.fillStyle = "rgb(0,102,153)";
        for (var i = 0; i < digit[num].length; i++)
            for (var j = 0; j < digit[num][i].length; j++)
                if (digit[num][i][j] == 1) {
                    cxt.beginPath()
                    cxt.arc(x + (RADIUS + 1) + j * 2 * (RADIUS + 1), y + (RADIUS + 1) + i * 2 * (RADIUS + 1), RADIUS, 0, 2 * Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
    }
    function update() {
        var nextTime = new Date();
        var nexttimehours = parseInt(nextTime.getHours());
        var nexttimeminutes = parseInt(nextTime.getMinutes());
        var nexttimeseconds = parseInt(nextTime.getSeconds());
        var showtimehours = parseInt(showtime.getHours());
        var showtimeminutes = parseInt(showtime.getMinutes());
        var showtimeseconds = parseInt(showtime.getSeconds());
        if (nextTime != showtime) {
            if (parseInt(nexttimehours / 10) != parseInt(showtimehours / 10)) {
                addballs(MARGIN_LEFT, MARGIN_TOP, parseInt(nexttimehours / 10));
            }
            ;
            if (parseInt(nexttimehours % 10) != parseInt(showtimehours % 10)) {
                addballs(MARGIN_LEFT + 15 * (RADIUS + 1), MARGIN_TOP, parseInt(nexttimehours % 10));
            }
            ;
            if (parseInt(nexttimeminutes / 10) != parseInt(showtimeminutes / 10)) {
                addballs(MARGIN_LEFT + 39 * (RADIUS + 1), MARGIN_TOP, parseInt(nexttimeminutes / 10));
            }
            ;
            if (parseInt(nexttimeminutes % 10) != parseInt(showtimeminutes % 10)) {
                addballs(MARGIN_LEFT + 54 * (RADIUS + 1), MARGIN_TOP, parseInt(nexttimeminutes % 10));
            }
            ;
            if (parseInt(nexttimeseconds / 10) != parseInt(showtimeseconds / 10)) {
                addballs(MARGIN_LEFT + 78 * (RADIUS + 1), MARGIN_TOP, parseInt(nexttimeseconds / 10));
            }
            ;
            if (parseInt(nexttimeseconds % 10) != parseInt(showtimeseconds % 10)) {
                addballs(MARGIN_LEFT + 93 * (RADIUS + 1), MARGIN_TOP, parseInt(nexttimeseconds % 10));
            }
            ;
        }
        showtime = nextTime;
        updateBalls();
    }
    function updateBalls() {
        for (var i = 0; i < balls.length; i++) {
            balls[i].x += balls[i].vx;
            balls[i].y += balls[i].vy;
            balls[i].vy += balls[i].g;
            if (balls[i].y > WINDOW_HEIGHT - RADIUS) {
                balls[i].y = WINDOW_HEIGHT - RADIUS;
                balls[i].vy = -balls[i].vy * 0.6;
            }
        }
        var ballscontol = 0;
        for (i = 0; i < balls.length; i++)
            if (balls[i].x + RADIUS > 0 && balls[i].x - RADIUS < WINDOW_WIDTH) {
                balls[ballscontol++] = balls[i]
            }
        while (balls.length > Math.min(ballscontol, 300)) {
            balls.pop();
        }
    }
    function addballs(x, y, num) {
        for (var i = 0; i < digit[num].length; i++)
            for (var j = 0; j < digit[num][i].length; j++)
                if (digit[num][i][j] == 1) {
                    var newball = {
                        x: x + (RADIUS + 1) + j * 2 * (RADIUS + 1),
                        y: y + (RADIUS + 1) + i * 2 * (RADIUS + 1),
                        g: 1.5 + Math.random(),
                        vx: Math.pow(-1, Math.floor(Math.random() * 100)) * 5,
                        vy: -Math.ceil(Math.random() * 10),
                        color: colors[Math.floor(Math.random() * colors.length)]
                    }
                    balls.push(newball);
                }
    }
</script>
</html>